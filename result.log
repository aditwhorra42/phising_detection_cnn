============================= test session starts ==============================
platform darwin -- Python 3.11.4, pytest-8.2.2, pluggy-1.5.0
rootdir: /Users/arnobchowdhury/Documents/university_work/realm/remla-team-6/phishing_detection_cnn
configfile: pyproject.toml
plugins: hydra-core-1.3.2
collected 13 items

tests/data_features/test_data_distribution.py F                          [  7%]
tests/model_development/test_model_development.py Fssssss                [ 61%]
tests/models/test_model.py .                                             [ 69%]
tests/test_inference.py s                                                [ 76%]
tests/test_memory.py s                                                   [ 84%]
tests/test_mutamorphic.py E                                              [ 92%]
tests/test_reproducibility.py F                                          [100%]

==================================== ERRORS ====================================
______________________ ERROR at setup of test_mutamorphic ______________________

data_path = 'data/DL Dataset/test.txt'

    def load_dataset(data_path: str) -> Tuple[List[str], List[str]]:
        """Loads the data split from the path. The path should be a .txt file that
        has been created from the get_data step. his should be stored in the data folder.
    
        Args:
            data_path (str): The path to the split .txt file.
    
        Returns:
            Tuple[List[str], List[str]]: Returns a tuple of raw_x and raw_y. raw_x is a
            list of strings for all the sentences in the split and raw_y is their corresponding label.
        """
        print(f"Loading dataset: {data_path}")
    
        try:
>           with open(data_path, "r") as data_file:
E           FileNotFoundError: [Errno 2] No such file or directory: 'data/DL Dataset/test.txt'

src/features/build_features.py:32: FileNotFoundError

The above exception was the direct cause of the following exception:

    @pytest.fixture()
    def dataset_raw_test():
>       X_test, y_test = load_dataset("data/DL Dataset/test.txt")

tests/fixtures/fixtures.py:21: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

data_path = 'data/DL Dataset/test.txt'

    def load_dataset(data_path: str) -> Tuple[List[str], List[str]]:
        """Loads the data split from the path. The path should be a .txt file that
        has been created from the get_data step. his should be stored in the data folder.
    
        Args:
            data_path (str): The path to the split .txt file.
    
        Returns:
            Tuple[List[str], List[str]]: Returns a tuple of raw_x and raw_y. raw_x is a
            list of strings for all the sentences in the split and raw_y is their corresponding label.
        """
        print(f"Loading dataset: {data_path}")
    
        try:
            with open(data_path, "r") as data_file:
                loaded_data = [line.strip() for line in data_file.readlines()[1:]]
        except FileNotFoundError as file_not_found_error:
>           raise FileNotFoundError(f"Could not find file {data_path}.") from file_not_found_error
E           FileNotFoundError: Could not find file data/DL Dataset/test.txt.

src/features/build_features.py:35: FileNotFoundError
---------------------------- Captured stdout setup -----------------------------
Loading dataset: data/DL Dataset/test.txt
=================================== FAILURES ===================================
____________________________ test_legitimate_ratio _____________________________

    def test_legitimate_ratio():
        legitimate = 0
        phishing = 0
>       with open(os.path.join("data", "DL Dataset", "train.txt"), "r") as f:
E       FileNotFoundError: [Errno 2] No such file or directory: 'data/DL Dataset/train.txt'

tests/data_features/test_data_distribution.py:8: FileNotFoundError
_____________________________________ test _____________________________________

    def test():
        """Performs the testing of the trained model.
        """
    
        X_test, y_test = load_from_pickle_file("data/tokenized/test.pkl")
        model = load_model("model/model.keras")
    
        X_test = X_test[:N_SIZE_TESTDATA]
>       y_pred, time = predict_with_time(model, X_test)

src/test.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
src/common/timer.py:25: in wrapper
    results = func(*args, **kwargs)
src/common/timer.py:44: in predict_with_time
    return model.predict(X_test)
../../../../../Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py:122: in error_handler
    raise e.with_traceback(filtered_tb) from None
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

op_name = '__inference_one_step_on_data_distributed_626', num_outputs = 1
inputs = [<tf.Tensor: shape=(32, 200), dtype=int64, numpy=
array([[  101,  8299,  1024, ...,     0,     0,     0],
       [  10...ce:CPU:0", container="Anonymous", type="tensorflow::Var", dtype and shapes : "[ DType enum: 1, Shape: [128] ]")>>, ...]
attrs = ('executor_type', '', 'config_proto', b'\n\x07\n\x03CPU\x10\x01\n\x07\n\x03GPU\x10\x002\x02J\x008\x01\x82\x01\x00')
ctx = <tensorflow.python.eager.context.Context object at 0x28b580d90>
name = None

    def quick_execute(op_name, num_outputs, inputs, attrs, ctx, name=None):
      """Execute a TensorFlow operation.
    
      Args:
        op_name: Name of the TensorFlow operation (see REGISTER_OP in C++ code) to
          execute.
        num_outputs: The number of outputs of the operation to fetch. (Explicitly
          provided instead of being inferred for performance reasons).
        inputs: A list of inputs to the operation. Each entry should be a Tensor, or
          a value which can be passed to the Tensor constructor to create one.
        attrs: A tuple with alternating string attr names and attr values for this
          operation.
        ctx: The value of context.context().
        name: Customized name for the operation.
    
      Returns:
        List of output Tensor objects. The list is empty if there are no outputs
    
      Raises:
        An exception on error.
      """
      device_name = ctx.device_name
      # pylint: disable=protected-access
      try:
        ctx.ensure_initialized()
>       tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,
                                            inputs, attrs, num_outputs)
E                                           tensorflow.python.framework.errors_impl.InvalidArgumentError: Graph execution error:
E                                           
E                                           Detected at node sequential_1_1/embedding_1_1/GatherV2 defined at (most recent call last):
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/bin/pytest", line 8, in <module>
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/config/__init__.py", line 206, in console_main
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/config/__init__.py", line 178, in main
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/main.py", line 332, in pytest_cmdline_main
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/main.py", line 285, in wrap_session
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/main.py", line 339, in _main
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/main.py", line 364, in pytest_runtestloop
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 116, in pytest_runtest_protocol
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 135, in runtestprotocol
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 240, in call_and_report
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 341, in from_call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 241, in <lambda>
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 173, in pytest_runtest_call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/python.py", line 1632, in runtest
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/python.py", line 162, in pytest_pyfunc_call
E                                           
E                                             File "/Users/arnobchowdhury/Documents/university_work/realm/remla-team-6/phishing_detection_cnn/src/test.py", line 23, in test
E                                           
E                                             File "/Users/arnobchowdhury/Documents/university_work/realm/remla-team-6/phishing_detection_cnn/src/common/timer.py", line 25, in wrapper
E                                           
E                                             File "/Users/arnobchowdhury/Documents/university_work/realm/remla-team-6/phishing_detection_cnn/src/common/timer.py", line 44, in predict_with_time
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 504, in predict
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 204, in one_step_on_data_distributed
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 194, in one_step_on_data
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 92, in predict_step
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/layers/layer.py", line 846, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/ops/operation.py", line 48, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/models/sequential.py", line 209, in call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/models/functional.py", line 202, in call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/ops/function.py", line 155, in _run_through_graph
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/models/functional.py", line 592, in call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/layers/layer.py", line 846, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/ops/operation.py", line 48, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/layers/core/embedding.py", line 146, in call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/ops/numpy.py", line 4850, in take
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/numpy.py", line 1940, in take
E                                           
E                                           indices[11,0] = 101 is not in [0, 72)
E                                           	 [[{{node sequential_1_1/embedding_1_1/GatherV2}}]] [Op:__inference_one_step_on_data_distributed_626]

../../../../../Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/tensorflow/python/eager/execute.py:53: InvalidArgumentError
----------------------------- Captured stderr call -----------------------------
2024-06-24 17:23:27.908080: W tensorflow/core/framework/local_rendezvous.cc:404] Local rendezvous is aborting with status: INVALID_ARGUMENT: indices[11,0] = 101 is not in [0, 72)
	 [[{{node sequential_1_1/embedding_1_1/GatherV2}}]]
_____________________________ test_reproducibility _____________________________

data_path = 'data/DL Dataset/train.txt'

    def load_dataset(data_path: str) -> Tuple[List[str], List[str]]:
        """Loads the data split from the path. The path should be a .txt file that
        has been created from the get_data step. his should be stored in the data folder.
    
        Args:
            data_path (str): The path to the split .txt file.
    
        Returns:
            Tuple[List[str], List[str]]: Returns a tuple of raw_x and raw_y. raw_x is a
            list of strings for all the sentences in the split and raw_y is their corresponding label.
        """
        print(f"Loading dataset: {data_path}")
    
        try:
>           with open(data_path, "r") as data_file:
E           FileNotFoundError: [Errno 2] No such file or directory: 'data/DL Dataset/train.txt'

src/features/build_features.py:32: FileNotFoundError

The above exception was the direct cause of the following exception:

    @pytest.mark.skipif(SKIP_REPRODUCIBILITY_TEST == True, reason="Trains the model twice")
    def test_reproducibility():
>       build_features.preprocess()

tests/test_reproducibility.py:14: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
src/features/build_features.py:61: in preprocess
    raw_x, raw_y = load_dataset(data_path=os.path.join(params["dataset_dir"], data_file))
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

data_path = 'data/DL Dataset/train.txt'

    def load_dataset(data_path: str) -> Tuple[List[str], List[str]]:
        """Loads the data split from the path. The path should be a .txt file that
        has been created from the get_data step. his should be stored in the data folder.
    
        Args:
            data_path (str): The path to the split .txt file.
    
        Returns:
            Tuple[List[str], List[str]]: Returns a tuple of raw_x and raw_y. raw_x is a
            list of strings for all the sentences in the split and raw_y is their corresponding label.
        """
        print(f"Loading dataset: {data_path}")
    
        try:
            with open(data_path, "r") as data_file:
                loaded_data = [line.strip() for line in data_file.readlines()[1:]]
        except FileNotFoundError as file_not_found_error:
>           raise FileNotFoundError(f"Could not find file {data_path}.") from file_not_found_error
E           FileNotFoundError: Could not find file data/DL Dataset/train.txt.

src/features/build_features.py:35: FileNotFoundError
----------------------------- Captured stdout call -----------------------------
Loading dataset: data/DL Dataset/train.txt
=============================== warnings summary ===============================
tests/test_reproducibility.py::test_reproducibility
  /Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/sklearn/base.py:376: InconsistentVersionWarning: Trying to unpickle estimator LabelEncoder from version 1.4.2 when using version 1.5.0. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
  https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/data_features/test_data_distribution.py::test_legitimate_ratio
FAILED tests/model_development/test_model_development.py::test - tensorflow.p...
FAILED tests/test_reproducibility.py::test_reproducibility - FileNotFoundErro...
ERROR tests/test_mutamorphic.py::test_mutamorphic - FileNotFoundError: Could ...
========== 3 failed, 1 passed, 8 skipped, 1 warning, 1 error in 5.65s ==========
============================= test session starts ==============================
platform darwin -- Python 3.11.4, pytest-8.2.2, pluggy-1.5.0
rootdir: /Users/arnobchowdhury/Documents/university_work/realm/remla-team-6/phishing_detection_cnn
configfile: pyproject.toml
plugins: hydra-core-1.3.2
collected 13 items

tests/data_features/test_data_distribution.py F                          [  7%]
tests/model_development/test_model_development.py Fssssss                [ 61%]
tests/models/test_model.py .                                             [ 69%]
tests/test_inference.py s                                                [ 76%]
tests/test_memory.py s                                                   [ 84%]
tests/test_mutamorphic.py E                                              [ 92%]
tests/test_reproducibility.py F                                          [100%]

==================================== ERRORS ====================================
______________________ ERROR at setup of test_mutamorphic ______________________

data_path = 'data/DL Dataset/test.txt'

    def load_dataset(data_path: str) -> Tuple[List[str], List[str]]:
        """Loads the data split from the path. The path should be a .txt file that
        has been created from the get_data step. his should be stored in the data folder.
    
        Args:
            data_path (str): The path to the split .txt file.
    
        Returns:
            Tuple[List[str], List[str]]: Returns a tuple of raw_x and raw_y. raw_x is a
            list of strings for all the sentences in the split and raw_y is their corresponding label.
        """
        print(f"Loading dataset: {data_path}")
    
        try:
>           with open(data_path, "r") as data_file:
E           FileNotFoundError: [Errno 2] No such file or directory: 'data/DL Dataset/test.txt'

src/features/build_features.py:32: FileNotFoundError

The above exception was the direct cause of the following exception:

    @pytest.fixture()
    def dataset_raw_test():
>       X_test, y_test = load_dataset("data/DL Dataset/test.txt")

tests/fixtures/fixtures.py:21: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

data_path = 'data/DL Dataset/test.txt'

    def load_dataset(data_path: str) -> Tuple[List[str], List[str]]:
        """Loads the data split from the path. The path should be a .txt file that
        has been created from the get_data step. his should be stored in the data folder.
    
        Args:
            data_path (str): The path to the split .txt file.
    
        Returns:
            Tuple[List[str], List[str]]: Returns a tuple of raw_x and raw_y. raw_x is a
            list of strings for all the sentences in the split and raw_y is their corresponding label.
        """
        print(f"Loading dataset: {data_path}")
    
        try:
            with open(data_path, "r") as data_file:
                loaded_data = [line.strip() for line in data_file.readlines()[1:]]
        except FileNotFoundError as file_not_found_error:
>           raise FileNotFoundError(f"Could not find file {data_path}.") from file_not_found_error
E           FileNotFoundError: Could not find file data/DL Dataset/test.txt.

src/features/build_features.py:35: FileNotFoundError
---------------------------- Captured stdout setup -----------------------------
Loading dataset: data/DL Dataset/test.txt
=================================== FAILURES ===================================
____________________________ test_legitimate_ratio _____________________________

    def test_legitimate_ratio():
        legitimate = 0
        phishing = 0
>       with open(os.path.join("data", "DL Dataset", "train.txt"), "r") as f:
E       FileNotFoundError: [Errno 2] No such file or directory: 'data/DL Dataset/train.txt'

tests/data_features/test_data_distribution.py:8: FileNotFoundError
_____________________________________ test _____________________________________

    def test():
        """Performs the testing of the trained model.
        """
    
        X_test, y_test = load_from_pickle_file("data/tokenized/test.pkl")
        model = load_model("model/model.keras")
    
        X_test = X_test[:N_SIZE_TESTDATA]
>       y_pred, time = predict_with_time(model, X_test)

src/test.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
src/common/timer.py:25: in wrapper
    results = func(*args, **kwargs)
src/common/timer.py:44: in predict_with_time
    return model.predict(X_test)
../../../../../Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py:122: in error_handler
    raise e.with_traceback(filtered_tb) from None
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

op_name = '__inference_one_step_on_data_distributed_626', num_outputs = 1
inputs = [<tf.Tensor: shape=(32, 200), dtype=int64, numpy=
array([[  101,  8299,  1024, ...,     0,     0,     0],
       [  10...ce:CPU:0", container="Anonymous", type="tensorflow::Var", dtype and shapes : "[ DType enum: 1, Shape: [128] ]")>>, ...]
attrs = ('executor_type', '', 'config_proto', b'\n\x07\n\x03CPU\x10\x01\n\x07\n\x03GPU\x10\x002\x02J\x008\x01\x82\x01\x00')
ctx = <tensorflow.python.eager.context.Context object at 0x28991d0d0>
name = None

    def quick_execute(op_name, num_outputs, inputs, attrs, ctx, name=None):
      """Execute a TensorFlow operation.
    
      Args:
        op_name: Name of the TensorFlow operation (see REGISTER_OP in C++ code) to
          execute.
        num_outputs: The number of outputs of the operation to fetch. (Explicitly
          provided instead of being inferred for performance reasons).
        inputs: A list of inputs to the operation. Each entry should be a Tensor, or
          a value which can be passed to the Tensor constructor to create one.
        attrs: A tuple with alternating string attr names and attr values for this
          operation.
        ctx: The value of context.context().
        name: Customized name for the operation.
    
      Returns:
        List of output Tensor objects. The list is empty if there are no outputs
    
      Raises:
        An exception on error.
      """
      device_name = ctx.device_name
      # pylint: disable=protected-access
      try:
        ctx.ensure_initialized()
>       tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,
                                            inputs, attrs, num_outputs)
E                                           tensorflow.python.framework.errors_impl.InvalidArgumentError: Graph execution error:
E                                           
E                                           Detected at node sequential_1_1/embedding_1_1/GatherV2 defined at (most recent call last):
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/bin/pytest", line 8, in <module>
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/config/__init__.py", line 206, in console_main
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/config/__init__.py", line 178, in main
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/main.py", line 332, in pytest_cmdline_main
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/main.py", line 285, in wrap_session
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/main.py", line 339, in _main
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/main.py", line 364, in pytest_runtestloop
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 116, in pytest_runtest_protocol
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 135, in runtestprotocol
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 240, in call_and_report
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 341, in from_call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 241, in <lambda>
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/runner.py", line 173, in pytest_runtest_call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/python.py", line 1632, in runtest
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py", line 513, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/pluggy/_callers.py", line 103, in _multicall
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/_pytest/python.py", line 162, in pytest_pyfunc_call
E                                           
E                                             File "/Users/arnobchowdhury/Documents/university_work/realm/remla-team-6/phishing_detection_cnn/src/test.py", line 23, in test
E                                           
E                                             File "/Users/arnobchowdhury/Documents/university_work/realm/remla-team-6/phishing_detection_cnn/src/common/timer.py", line 25, in wrapper
E                                           
E                                             File "/Users/arnobchowdhury/Documents/university_work/realm/remla-team-6/phishing_detection_cnn/src/common/timer.py", line 44, in predict_with_time
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 504, in predict
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 204, in one_step_on_data_distributed
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 194, in one_step_on_data
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 92, in predict_step
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/layers/layer.py", line 846, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/ops/operation.py", line 48, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/models/sequential.py", line 209, in call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/models/functional.py", line 202, in call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/ops/function.py", line 155, in _run_through_graph
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/models/functional.py", line 592, in call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/layers/layer.py", line 846, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/ops/operation.py", line 48, in __call__
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/layers/core/embedding.py", line 146, in call
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/ops/numpy.py", line 4850, in take
E                                           
E                                             File "/Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/keras/src/backend/tensorflow/numpy.py", line 1940, in take
E                                           
E                                           indices[8,0] = 101 is not in [0, 72)
E                                           	 [[{{node sequential_1_1/embedding_1_1/GatherV2}}]] [Op:__inference_one_step_on_data_distributed_626]

../../../../../Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/tensorflow/python/eager/execute.py:53: InvalidArgumentError
----------------------------- Captured stderr call -----------------------------
2024-06-24 17:31:41.315008: W tensorflow/core/framework/local_rendezvous.cc:404] Local rendezvous is aborting with status: INVALID_ARGUMENT: indices[8,0] = 101 is not in [0, 72)
	 [[{{node sequential_1_1/embedding_1_1/GatherV2}}]]
_____________________________ test_reproducibility _____________________________

data_path = 'data/DL Dataset/train.txt'

    def load_dataset(data_path: str) -> Tuple[List[str], List[str]]:
        """Loads the data split from the path. The path should be a .txt file that
        has been created from the get_data step. his should be stored in the data folder.
    
        Args:
            data_path (str): The path to the split .txt file.
    
        Returns:
            Tuple[List[str], List[str]]: Returns a tuple of raw_x and raw_y. raw_x is a
            list of strings for all the sentences in the split and raw_y is their corresponding label.
        """
        print(f"Loading dataset: {data_path}")
    
        try:
>           with open(data_path, "r") as data_file:
E           FileNotFoundError: [Errno 2] No such file or directory: 'data/DL Dataset/train.txt'

src/features/build_features.py:32: FileNotFoundError

The above exception was the direct cause of the following exception:

    @pytest.mark.skipif(SKIP_REPRODUCIBILITY_TEST == True, reason="Trains the model twice")
    def test_reproducibility():
>       build_features.preprocess()

tests/test_reproducibility.py:14: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
src/features/build_features.py:61: in preprocess
    raw_x, raw_y = load_dataset(data_path=os.path.join(params["dataset_dir"], data_file))
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

data_path = 'data/DL Dataset/train.txt'

    def load_dataset(data_path: str) -> Tuple[List[str], List[str]]:
        """Loads the data split from the path. The path should be a .txt file that
        has been created from the get_data step. his should be stored in the data folder.
    
        Args:
            data_path (str): The path to the split .txt file.
    
        Returns:
            Tuple[List[str], List[str]]: Returns a tuple of raw_x and raw_y. raw_x is a
            list of strings for all the sentences in the split and raw_y is their corresponding label.
        """
        print(f"Loading dataset: {data_path}")
    
        try:
            with open(data_path, "r") as data_file:
                loaded_data = [line.strip() for line in data_file.readlines()[1:]]
        except FileNotFoundError as file_not_found_error:
>           raise FileNotFoundError(f"Could not find file {data_path}.") from file_not_found_error
E           FileNotFoundError: Could not find file data/DL Dataset/train.txt.

src/features/build_features.py:35: FileNotFoundError
----------------------------- Captured stdout call -----------------------------
Loading dataset: data/DL Dataset/train.txt
=============================== warnings summary ===============================
tests/test_reproducibility.py::test_reproducibility
  /Users/arnobchowdhury/Library/Caches/pypoetry/virtualenvs/phising-detection-cnn-fgXeoasf-py3.11/lib/python3.11/site-packages/sklearn/base.py:376: InconsistentVersionWarning: Trying to unpickle estimator LabelEncoder from version 1.4.2 when using version 1.5.0. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
  https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/data_features/test_data_distribution.py::test_legitimate_ratio
FAILED tests/model_development/test_model_development.py::test - tensorflow.p...
FAILED tests/test_reproducibility.py::test_reproducibility - FileNotFoundErro...
ERROR tests/test_mutamorphic.py::test_mutamorphic - FileNotFoundError: Could ...
========== 3 failed, 1 passed, 8 skipped, 1 warning, 1 error in 5.70s ==========
